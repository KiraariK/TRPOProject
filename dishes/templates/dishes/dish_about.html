{% extends "base.html" %}
{% load static %}

{% block content %}

<style>
    h1 {
    font-family: Geneva, Arial, Helvetica, sans-serif;}
     p {
    font-family: Georgia, 'Times New Roman', Times, serif;
   }
</style>

    <div class="row">
        <img src="{% static 'images/cart/cart_icon.png' %}" class="img-thumbnail">
        <p id="cart_value">0 р.</p>
    </div>
 <div class="row">
     <div class="col-xs-11">
         <h1>{{dish.name}}</h1>
         <div class="row">
         <div class="col-xs-4">
             <div>
                <img src="{% static 'images/'|add:dish.dish_image.name %}" class="img-rounded">
             </div>
             <p><a class="btn btn-default" onClick="addDish({{ dish.id }}, {{ dish.price }})" role="button">+</a></p>
             <div>
                 <p>{{dish.composition}}</p>
                 <p>Вес: {{dish.weight}}</p>
                 <p>Цена: {{dish.price}}</p>
             </div>
         </div>
         <div class="col-xs-8"></div>
             <p>{{dish.description}}</p>

         </div>
     </div>
 </div>

{% endblock %}

{% block scripts %}

    <script type="text/javascript">
        // TODO функция не вызывается, если на страницу попадаем с помощью клавиши 'назад' в боаузере
        $(document).ready(function() {
            $.get("{% url 'cart_loading' %}", function(data) {
                var cart_value = Number(data);
                var cart_value_str = String(cart_value) + " р.";
                $("#cart_value").text(cart_value_str);
            });
        })

        function addDish(dish_id, dish_price) {
            $.get("{% url 'cart_updating' %}", {"id" : dish_id}, function(data) {
               updateCart(dish_id, dish_price);
            });
        }

        function updateCart(dish_id, dish_price) {
            var strings = $('#cart_value').text().split(" ");
            var cart_price = Number($('#cart_value').text().split(" ")[0]);
            var new_cart_price = cart_price + dish_price;
            $('#cart_value').text(new_cart_price + " р.");
        }
    </script>

{% endblock %}
